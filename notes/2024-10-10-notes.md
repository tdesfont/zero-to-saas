# 2024-10-10

## Creating the Python docs for the whole project

First step, we can define the documentation framework that we will use for this project. We will be using MkDocs:
https://www.mkdocs.org/getting-started/

Open the project as a Python project and setup a Virtual env with PyCharm.
In order to open the docs of the project:

```
pip install mkdocs
mkdocs new docs
cd docs
mkdocs serve
```

## Creating a marketing website for the application (Hosted on Netlify)

In order to develop the static public website locally:
```
cd public-website/react-frontend
npm start
```

Then deploy to web by hosting on Netlify:
https://app.netlify.com/teams/tdesfont/billing/usage#sites

Push the code to Github and use Import an existing project.

## Creating a local version of the React Native application

We want users to store their tasks using a mobile application, therefore we create the simplest possible React Native application to send tasks to a backend to create the tasks. 

```
tbd@Thibaults-MacBook-Pro zero-to-saas % node --version
v20.17.0
tbd@Thibaults-MacBook-Pro zero-to-saas % nvm use 18
Now using node v18.20.4 (npm v10.7.0)
```

```
tbd@Thibaults-MacBook-Pro zero-to-saas % npx create-expo-app@latest
✔ What is your app named? … mobile-app-simple-tasks-manager
✔ Downloaded and extracted project files.
```

Test the app locally (Connect your phone to your computer, make sure phone and computer are on the same Network):
```
tbd@Thibaults-MacBook-Pro zero-to-saas % cd mobile-app-simple-tasks-manager
tbd@Thibaults-MacBook-Pro mobile-app-simple-tasks-manager % npm start
```
Enter `a` to reload the app on Android.

If you find the following error:
```
Starting project at /Users/tbd/CodeProjectsPersonalPublicOnGithub/zero-to-saas/mobile-app-simple-tasks-manager
Starting Metro Bundler
node:events:495
      throw er; // Unhandled 'error' event
      ^

Error: EMFILE: too many open files, watch
    at FSEvent.FSWatcher._handle.onchange (node:internal/fs/watchers:207:21)
Emitted 'error' event on NodeWatcher instance at:
    at FSWatcher._checkedEmitError (/Users/tbd/CodeProjectsPersonalPublicOnGithub/zero-to-saas/mobile-app-simple-tasks-manager/node_modules/metro-file-map/src/watchers/NodeWatcher.js:82:12)
    at FSWatcher.emit (node:events:517:28)
    at FSEvent.FSWatcher._handle.onchange (node:internal/fs/watchers:213:12) {
  errno: -24,
  syscall: 'watch',
  code: 'EMFILE',
  filename: null
}
```

Remove the modules:
```
tbd@Thibaults-MacBook-Pro mobile-app-simple-tasks-manager % rm -rf node_modules
npm install --save
npm start
a
```

Then see the app being loaded on your Android mobile device:
[](/Users/tbd/CodeProjectsPersonalPublicOnGithub/zero-to-saas/notes/Screenshot_20241011-110423_Expo Go.jpg)
[](/Users/tbd/CodeProjectsPersonalPublicOnGithub/zero-to-saas/notes/Screenshot_20241011-110412_Expo Go.jpg)


```
npm install --save axios
```

Adding a new React Native component:
mobile-app-simple-tasks-manager/components/tasksScheduler/TaskCreator.tsx

I add the axios call to start interacting with a backend, for now the task is hardcoded JSON object but this is sufficient to test the logic of the application, leading to the following application on mobile:
[](/Users/tbd/CodeProjectsPersonalPublicOnGithub/zero-to-saas/notes/Screenshot_20241011-110423_Expo Go.jpg)

Clicking on `Create new task` will send a request to the backend (Should it be running locally or on a Cloud), for now since there is no backend, the call will fail with a Network Error.

## Creating a local version of the Flask backend

In order to receive and process calls from the mobile app, we are going to create now a server (It's going to be a Flask backend, simple and scalable Python based routes and backend logic definition). At firt, we will run this server locally and we will then run the same server on a Cloud.

```
mkdir flask-backend
```

Using PyCharm, I setup a Virtual Environment that we can use in Python to handle package dependencies (Flask, flask-cors).

```
cd flask-backend
python app.py

 * Serving Flask app 'app'
 * Debug mode: off
WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.43.62:5000
Press CTRL+C to quit
```

Now we can check that the React Native application can "talk" to the backend server:

Logs of the Python Flask backend server:
```
WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.43.62:5000
Press CTRL+C to quit
192.168.43.1 - - [11/Oct/2024 12:02:29] "POST /create_event HTTP/1.1" 200 -
```

Logs of the React Native app:
```
Logs for your project will appear below. Press Ctrl+C to exit.
› Opening on Android...
› Opening exp://192.168.43.62:8081 on SM_J600FN
› Press ? │ show all commands
Android Bundled 707ms node_modules/expo-router/entry.js (1153 modules)
 LOG  Tasks sent successfully: {"event": {"description": "Need to create a backend (Likely in GCP) in order to support task creation, storage and retrieval.", "endtimestamp": "Fri, 11 Oct 2024 14:24:00 GMT", "eventid": "event.id.1d8db25704c2f2", "starttimestamp": "Fri, 11 Oct 2024 11:32:00 GMT", "status": "To be done", "title": "Deploying Cloud backend for Task Scheduler application"}, "message": "Event creation request received"}
```

Note that we have to edit the url of the axios call and that the url of Flask can change, we will therefore have to make that url an environment variable at some point.

## Creating a PostGreSQL database in Google Cloud

Considering the events and their fixed schema structure, we are going to need a DB in which we can store those. To do so, we are going to use Google Cloud SQL (PostGres).

```
mkdir gcp-cloud-sql
cd gcp-cloud-sql
```

Download the cloud-sql-proxy from https://github.com/GoogleCloudPlatform/cloud-sql-proxy/releases.
Create the PostGreSAL database on GCP, start from scratch and run the commands 

Go to your DB on GCP:
https://console.cloud.google.com/sql/instances/realtimeselforganizingagendadb/overview?hl=fr&project=forward-emitter-427016-s9

Connect to your DB using Cloud SQL studio:
https://console.cloud.google.com/sql/instances/realtimeselforganizingagendadb/studio?hl=fr&project=forward-emitter-427016-s9

Run the SQL commands to create the table from scratch:
```
DROP TABLE events;

CREATE TABLE events (
    eventId VARCHAR(255) PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    status VARCHAR(50),
    startTimestamp TIMESTAMP NOT NULL,
    endTimestamp TIMESTAMP
);

INSERT INTO events (eventId, title, description, status, startTimestamp, endTimestamp)
VALUES ('event.id.1', 'Meeting with Eric', 'Discussing Q3 feature planning.', 'scheduled', '2024-10-13 10:00', '2024-10-13 11:00');

INSERT INTO events (eventId, title, description, status, startTimestamp, endTimestamp)
VALUES ('event.id.2', 'Sync with Emma', 'Weekly sync discussing the team projects', 'scheduled', '2024-10-13 12:00', '2024-10-13 13:00');

SELECT * FROM events;
```

## Interacting with your GCP PostGreSQL DB from your local shell

After downloading cloud-sql-proxy:
```
cd gcp-cloud-sql
./cloud-sql-proxy forward-emitter-427016-s9:us-central1:realtimeselforganizingagendadb
```
where forward-emitter-427016-s9:us-central1:realtimeselforganizingagendadb maps to {project name}:{cloud region (of the DB?)}:{db name}.

Leading to:
```
2024/10/11 12:44:11 Authorizing with Application Default Credentials
2024/10/11 12:44:13 [forward-emitter-427016-s9:us-central1:realtimeselforganizingagendadb] Listening on 127.0.0.1:5432
2024/10/11 12:44:13 The proxy has started successfully and is ready for new connections!
```

Once the proxy is running, from another shell, you can now connect directly to the GCP DB:
```
tbd@Thibaults-MacBook-Pro gcp-cloud-sql % psql "host=127.0.0.1 port=5432 sslmode=disable dbname=postgres user=postgres"
Password for user postgres:
psql (14.13 (Homebrew), server 16.4)
WARNING: psql major version 14, server major version 16.
         Some psql features might not work.
Type "help" for help.

postgres=> SELECT * FROM events;
  eventid   |       title       |               description                |  status   |   starttimestamp    |    endtimestamp
------------+-------------------+------------------------------------------+-----------+---------------------+---------------------
 event.id.1 | Meeting with Eric | Discussing Q3 feature planning.          | scheduled | 2024-10-13 10:00:00 | 2024-10-13 11:00:00
 event.id.2 | Sync with Emma    | Weekly sync discussing the team projects | scheduled | 2024-10-13 12:00:00 | 2024-10-13 13:00:00
(2 rows)
``` 

## Interacting with your GCP PostGreSQL DB from your local Flask backend